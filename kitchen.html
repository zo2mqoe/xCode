<!DOCTYPE html>
<html>
<head>
    <title>Kitchen Display System (KDS)</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        /* CSS styles (omitted for brevity) */
    </style>
</head>
<body>
    <h1>‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏Ñ‡∏£‡∏±‡∏ß (KDS) - ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h1>
    <div id="ordersContainer">
        </div>

    <script>
        // üö® ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ URL ‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞‡∏Ç‡∏≠‡∏á Backend Server (Render.com) ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        const BACKEND_URL = 'https://[YOUR_RENDER_API_URL]'; 
        
        const socket = io(BACKEND_URL); 
        const ordersContainer = document.getElementById('ordersContainer');

        async function updateStatus(orderId, newStatus) {
            // üö® ‡πÉ‡∏ä‡πâ URL Backend ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
            const response = await fetch(BACKEND_URL + '/api/order/status', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ order_id: orderId, status: newStatus })
            });
            const result = await response.json();
            if (!result.success) {
                alert(`‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${result.message}`);
            }
        }
        
        function renderOrderCard(order) {
            // ... ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á Card (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ...
            const cardId = `order-${order.order_id}`;
            let card = document.getElementById(cardId);
            if (!card) {
                card = document.createElement('div');
                card.id = cardId;
                ordersContainer.prepend(card); 
            }
            
            card.className = `order-card ${order.status.toLowerCase()}`;
            
            let itemsHtml = order.items.map(item => 
                `<li>${item.item_name} x ${item.quantity} 
                 ${item.notes ? `(${item.notes})` : ''}</li>`
            ).join('');

            card.innerHTML = `
                <h3>‡πÇ‡∏ï‡πä‡∏∞: ${order.table_number}</h3>
                <p style="font-size: small;">Order ID: ${order.order_id} | Time: ${order.order_time || 'N/A'}</p>
                <p>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <strong>${order.status}</strong></p>
                <ul>${itemsHtml}</ul>
                <button onclick="updateStatus(${order.order_id}, 'IN_PROGRESS')">üç¥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥</button>
                <button onclick="updateStatus(${order.order_id}, 'DONE')">‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</button>
            `;
        }

        // 1. ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å Socket.io
        socket.on('new_order', (order) => {
            renderOrderCard(order); 
        });

        // 2. ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏≤‡∏Å Socket.io
        socket.on('order_status_update', ({ order_id, status }) => {
            const card = document.getElementById(`order-${order_id}`);
            if (card) {
                card.className = `order-card ${status.toLowerCase()}`;
                card.querySelector('strong').innerText = status;

                if (status === 'DONE') {
                    setTimeout(() => {
                        const doneCard = document.getElementById(`order-${order_id}`);
                        if (doneCard) doneCard.style.display = 'none';
                    }, 5000); 
                }
            }
        });
    </script>
</body>
</html>
