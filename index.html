<!DOCTYPE html>
<html>
<head>
    <title>Customer Ordering</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        /* CSS styles (omitted for brevity) */
        .modal { display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); z-index: 100; overflow: auto; }
        .modal-content { background-color: white; width: 80%; max-width: 500px; margin: 50px auto; padding: 20px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
    </style>
</head>
<body>
    <h1>‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (‡πÇ‡∏ï‡πä‡∏∞‡∏´‡∏•‡∏±‡∏Å: <input type="text" id="tableNumber" value="T1" style="width: 50px;">)</h1>
    <p>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</p>
    <div id="menuList"></div>

    <h2>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ üõí</h2>
    <div id="cart"></div>
    <button onclick="submitOrder()" style="background-color: #007bff; color: white;">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
    <p id="message" style="margin-top: 15px; font-weight: bold;"></p>

    <div id="itemModal" class="modal">
        <div class="modal-content">
            <h2 id="modalItemName"></h2>
            <p>‡∏£‡∏≤‡∏Ñ‡∏≤: <span id="modalItemPrice"></span> ‡∏ö‡∏≤‡∏ó</p>
            <p>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢: <span id="modalItemDesc"></span></p>
            <hr>
            <label for="modalTableNumber">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÇ‡∏ï‡πä‡∏∞:</label>
            <select id="modalTableNumber"></select>
            <label for="modalQuantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:</label>
            <input type="number" id="modalQuantity" value="1" min="1">
            <label for="modalNotes">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</label>
            <input type="text" id="modalNotes" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ú‡πá‡∏î‡∏ô‡πâ‡∏≠‡∏¢, ‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏ú‡∏±‡∏Å‡∏ä‡∏µ">
            
            <button id="modalAddToCartBtn" style="background-color: #2ecc71; color: white;">‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
            <button onclick="closeModal()" style="background-color: #e74c3c; color: white;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <input type="hidden" id="modalItemId">
        </div>
    </div>

    <script>
        // üö® ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ URL ‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞‡∏Ç‡∏≠‡∏á Backend Server (Render.com) ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        const BACKEND_URL = 'https://[YOUR_RENDER_API_URL]'; 

        const socket = io(BACKEND_URL); 
        let cart = {}; 
        let menuData = []; 

        function openModal(item) {
            document.getElementById('modalItemId').value = item.item_id;
            document.getElementById('modalItemName').innerText = item.name;
            document.getElementById('modalItemPrice').innerText = item.price.toFixed(2);
            document.getElementById('modalItemDesc').innerText = item.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢';
            document.getElementById('modalTableNumber').value = document.getElementById('tableNumber').value || 'T1';
            document.getElementById('itemModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('itemModal').style.display = 'none';
            document.getElementById('modalQuantity').value = 1; 
            document.getElementById('modalNotes').value = ''; 
        }

        function createTableOptions() {
            const select = document.getElementById('modalTableNumber');
            for (let i = 1; i <= 10; i++) {
                const option = document.createElement('option');
                option.value = `T${i}`;
                option.text = `‡πÇ‡∏ï‡πä‡∏∞ ${i} (T${i})`;
                select.appendChild(option);
            }
            document.getElementById('tableNumber').value = 'T1';
        }
        createTableOptions();

        async function fetchMenu() {
            const response = await fetch(BACKEND_URL + '/api/menu'); 
            const data = await response.json();
            menuData = data.data;
            const menuList = document.getElementById('menuList');
            
            menuData.forEach(item => {
                const div = document.createElement('div');
                div.className = 'menu-item';
                div.innerHTML = `
                    <h3>${item.name} (${item.price.toFixed(2)} ‡∏ö‡∏≤‡∏ó)</h3>
                    <p>${item.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢'}</p>
                    <button style="background-color: #007bff; color: white;" onclick='openModal(${JSON.stringify(item)})'>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button> 
                `;
                menuList.appendChild(div);
            });
        }

        document.getElementById('modalAddToCartBtn').onclick = function() {
            const id = parseInt(document.getElementById('modalItemId').value);
            const quantity = parseInt(document.getElementById('modalQuantity').value);
            const notes = document.getElementById('modalNotes').value;
            const tableNumber = document.getElementById('modalTableNumber').value;
            
            document.getElementById('tableNumber').value = tableNumber;

            if (quantity > 0) {
                const item = menuData.find(i => i.item_id === id); 
                if (item) {
                    if (!cart[id]) {
                        cart[id] = { ...item, quantity: 0, notes: '' };
                    }
                    cart[id].quantity += quantity;
                    cart[id].notes = notes; 
                }
                renderCart();
                closeModal();
            }
        };

        function renderCart() {
            // ... ‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ...
            const cartDiv = document.getElementById('cart');
            cartDiv.innerHTML = '';
            let total = 0;
            const cartItems = Object.values(cart).filter(item => item.quantity > 0);

            if (cartItems.length === 0) {
                cartDiv.innerHTML = '<p>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</p>';
                return;
            }

            cartItems.forEach(item => {
                const itemTotal = item.quantity * item.price;
                total += itemTotal;
                const p = document.createElement('p');
                p.className = 'cart-item';
                p.innerHTML = `${item.name} x ${item.quantity} = ${itemTotal.toFixed(2)} ‡∏ö‡∏≤‡∏ó. 
                               ${item.notes ? `<br>(${item.notes})` : ''}`;
                cartDiv.appendChild(p);
            });
            cartDiv.innerHTML += `<h3>üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°: ${total.toFixed(2)} ‡∏ö‡∏≤‡∏ó</h3>`;
        }
        
        async function submitOrder() {
            const table_number = document.getElementById('tableNumber').value;
            const items = Object.values(cart)
                .filter(item => item.quantity > 0)
                .map(item => ({ 
                    item_id: item.item_id, 
                    quantity: item.quantity, 
                    notes: item.notes 
                }));

            if (!table_number || items.length === 0) {
                document.getElementById('message').innerText = '‚ùå ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÇ‡∏ï‡πä‡∏∞‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£';
                return;
            }

            document.getElementById('message').innerText = '...‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠...';

            // üö® ‡πÉ‡∏ä‡πâ URL Backend ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
            const response = await fetch(BACKEND_URL + '/api/order', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ table_number, items })
            });

            const result = await response.json();
            
            if (result.success) {
                document.getElementById('message').innerText = `‚úÖ ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! Order ID: ${result.order_id}, ‡∏£‡∏ß‡∏° ${result.total_amount} ‡∏ö‡∏≤‡∏ó`;
                cart = {};
                renderCart();
            } else {
                document.getElementById('message').innerText = `‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${result.message}`;
            }
        }

        fetchMenu();
    </script>
</body>
</html>
